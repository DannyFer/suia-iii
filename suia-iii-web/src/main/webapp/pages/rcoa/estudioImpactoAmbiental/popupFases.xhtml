<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:control="http://java.sun.com/jsf/composite/controles-prime">

		<h:form id="formDialog">
			<p:dialog header="Importante" id="dlgPasoFaltante" widgetVar="dlgPasoFaltante" modal="true" resizable="false"
			           width="300" closable="false">
			     <h:outputText value="Usted debe llenar antes la sección:" />
			     
			     <ul class="error alLeft text-red ">
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagCiclo}">
				         <li><p:commandLink  action="#{estudioImpactoAmbientalController.activarIndice('EIA_ALCANCE_CICLO_VIDA')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
				             <h:outputText class="text-red" value="Alcance, ciclo de vida y descripción detallada del proyecto"  />
				         </p:commandLink></li>
			     	</p:panelGrid>
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagAnalisis}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_ANALISIS_ALTERNATIVAS')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
							<h:outputText value="Análisis de las alternativas de las actividades del proyecto" class="text-red" />
						</p:commandLink></li>
			         </p:panelGrid>
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagDemanda}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_DEMANDA_RECURSOS_NATURALES')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Demanda de recursos naturales por parte del proyecto" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagDiagnostico}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_DIAGNOSTICO_AMBIENTAL')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Diagnóstico ambiental de línea base" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagInventario}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_INVENTARIO_FORESTAL')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Inventario forestal" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagIdentificacion}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_IDENTIFICACION_DETERMINACION_AREAS')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Identificación y determinación de áreas de influencia y áreas sensibles" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
			         
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagRiesgos}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_ANALISIS_RIESGOS')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Análisis de riesgos" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
			         
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagImpacto}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_EVALUACION_IMPACTOS_SOCIAMBIENTALES')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Evaluación de impactos socioambientales" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
			         
			     	<p:panelGrid rendered="#{estudioImpactoAmbientalController.pagPlan}">
						<li><p:commandLink action="#{estudioImpactoAmbientalController.activarIndice('EIA_PLAN_MANEJO_AMBIENTAL_Y_SUB_PLANES')}" oncomplete="PF('dlgPasoFaltante').hide();" update=":form :formMenuIzquierdo">
								<h:outputText value="Plan de manejo ambiental" class="text-red" />
							</p:commandLink></li>
			         </p:panelGrid>
					
			</ul>
			 </p:dialog>
		</h:form>
		
		
		<h:form id="formDialogAdjunto">
			<p:dialog id="adjuntoDiag" widgetVar="adjuntoDiag" header="Adjuntos" width="600px" closable="false" modal="true">
				<p:panelGrid id="adjuntosDiagGrid" columns="3" styleClass="panel_data w100" columnClasses="header w30,null w70">
					<h:outputText value="Adjuntar archivo de #{estudioImpactoAmbientalController.titulo}" />
					<p:panel id="pnUpload" style="border: none">
						<p:fileUpload fileUploadListener="#{estudioImpactoAmbientalController.asignarDocumentoEIA}"
							required="true" requiredMessage="Debe ingresar el adjunto" multiple="false" 
							sizeLimit="20971520" fileLimit="1" allowTypes="/(\.|\/)(pdf)$/" label="Seleccionar"
							uploadLabel="Subir" auto="true" update="adjuntosDiagGrid" cancelLabel="Cancelar"
							invalidFileMessage="Tipo de archivo no válido"
							invalidSizeMessage="Debe adjuntar un archivo no mayor de 20 Mb."
							mode="advanced" styleClass="w100" >
						</p:fileUpload>
						<p:commandButton id="downloadAdjunto"
							icon="ui-icon-arrowthick-1-s"
							styleClass="button-small primary toLeft" title="Ver" ajax="false"
							immediate="true"
							rendered="#{estudioImpactoAmbientalController.documentoAdjunto.nombre ne null}">
							<p:fileDownload value="#{descargarDocumentosCoaController.descargarDocumentoEIA(estudioImpactoAmbientalController.documentoAdjunto)}" />
						</p:commandButton>
						<p:outputLabel id="fileDocumentoAdjunto" value="#{estudioImpactoAmbientalController.documentoAdjunto.nombre}" />
					</p:panel>
				</p:panelGrid>
				<br />

				<p:separator />
				<div class="buttons">
					<p:commandButton icon="ui-icon-cancel" value="#{msg['button.cerrar']}" process="@this" oncomplete="PF('adjuntoDiag').hide()" styleClass="secondary" />
					<p:commandButton icon="ui-icon-plus" value="#{msg['button.aceptar']}" process="adjuntoDiag" oncomplete="if(!args.validationFailed) PF('adjuntoDiag').hide();"
						update="adjuntoDiag :form" actionListener="#{estudioImpactoAmbientalController.agregarAdjunto()}" />
				</div>
				
			</p:dialog>
			
			<p:dialog id="adjuntoAnexoDiag" widgetVar="adjuntoAnexoDiag" header="Adjuntos" width="600px" closable="false" modal="true">
				<p:panelGrid id="adjuntosAnexoDiagGrid" columns="3" styleClass="panel_data w100" columnClasses="header w30,null w70">
					<h:outputText value="Adjuntar archivo de #{estudioImpactoAmbientalController.titulo}" />
					<p:panel id="pnUploadAnexo" style="border: none">
						<p:fileUpload fileUploadListener="#{estudioImpactoAmbientalController.asignarDocumentoEIA}"
							required="true" requiredMessage="Debe ingresar el adjunto" multiple="false" 
							sizeLimit="20971520" fileLimit="1" allowTypes="/(\.|\/)(doc|docx|xls|xlsx|pdf|zip|rar|png|jpeg|bmp|jpg)$/" label="Seleccionar"
							uploadLabel="Subir" auto="true" update="adjuntosAnexoDiagGrid" cancelLabel="Cancelar"
							invalidFileMessage="Tipo de archivo no válido"
							invalidSizeMessage="Debe adjuntar un archivo no mayor de 20 Mb."
							mode="advanced" styleClass="w100" >
						</p:fileUpload>
						<p:commandButton id="downloadAdjuntoAnexo"
							icon="ui-icon-arrowthick-1-s"
							styleClass="button-small primary toLeft" title="Ver" ajax="false"
							immediate="true"
							rendered="#{estudioImpactoAmbientalController.documentoAdjunto.nombre ne null}">
							<p:fileDownload value="#{descargarDocumentosCoaController.descargarDocumentoEIA(estudioImpactoAmbientalController.documentoAdjunto)}" />
						</p:commandButton>
						<p:outputLabel id="fileDocumentoAdjuntoAnexo" value="#{estudioImpactoAmbientalController.documentoAdjunto.nombre}" />
					</p:panel>
				</p:panelGrid>
				<br />

				<p:separator />
				<div class="buttons">
					<p:commandButton icon="ui-icon-cancel" value="#{msg['button.cerrar']}" process="@this" oncomplete="PF('adjuntoAnexoDiag').hide()" styleClass="secondary" />
					<p:commandButton icon="ui-icon-plus" value="#{msg['button.aceptar']}" process="adjuntoAnexoDiag" oncomplete="if(!args.validationFailed) PF('adjuntoAnexoDiag').hide();"
						update="adjuntoAnexoDiag :form" actionListener="#{estudioImpactoAmbientalController.agregarAdjunto()}" />
				</div>
				
			</p:dialog>

	<p:dialog id="dlgAdjuntarPlanManejo" widgetVar="dlgAdjuntarPlanManejo"
		header="Adjuntar Sub Plan" modal="true" resizable="false" width="500">
		<h:panelGrid columns="1" styleClass="w100" columnClasses="null">
			<h:panelGrid columns="2" styleClass="w100"
				rendered="#{!estudioImpactoAmbientalController.planSeleccionado.subplan.requerido}">
				<h:outputText
					value="¿Desea ingresar el Sub Plan de Rescate de Vida Silvestre?" />
				<p:selectOneRadio id="rdbRequierePlan" required="true"
					requiredMessage="El campo '¿Desea ingresar el Sub Plan de Rescate de Vida Silvestre?' es requerido"
					value="#{estudioImpactoAmbientalController.planSeleccionado.planManejo.ingresoDetalle}"
					disabled="#{!estudioImpactoAmbientalController.habilitadoIngreso}">
					<f:selectItem itemValue="true" itemLabel="Si" />
					<f:selectItem itemValue="false" itemLabel="No" />
					<p:ajax event="change" process="@this" update="pnlIngresoPlan" />
				</p:selectOneRadio>
			</h:panelGrid>
		</h:panelGrid>

		<h:panelGrid id="pnlIngresoPlan" columns="1" styleClass="w100"
			columnClasses="null">
			<p:panel
				rendered="#{estudioImpactoAmbientalController.planSeleccionado.subplan.requerido or (!estudioImpactoAmbientalController.planSeleccionado.subplan.requerido and estudioImpactoAmbientalController.planSeleccionado.planManejo.ingresoDetalle)}">
				<h:outputText value="Seleccione el archivo excel (.xlsx)" />

				<p:fileUpload uploadLabel="Subir" auto="true" cancelLabel="Cancelar"
					label="Seleccionar" mode="advanced" dragDropSupport="false"
					multiple="false" allowTypes="/(\.|\/)(xlsx)$/"
					invalidFileMessage="El archivo es inválido."
					invalidSizeMessage="El archivo es demasiado grande."
					immediate="true" update="lblPlantillaSubPlan"
					fileUploadListener="#{estudioImpactoAmbientalController.handleFileUploadPlan}" />
				<p:outputLabel id="lblPlantillaSubPlan"
					value="#{estudioImpactoAmbientalController.documentoPlantillaPma.nombre}" />
			</p:panel>

			<h:panelGrid columns="1" styleClass="w100" columnClasses="null"
				rendered="#{!estudioImpactoAmbientalController.planSeleccionado.subplan.requerido and estudioImpactoAmbientalController.planSeleccionado.planManejo.ingresoDetalle ne null and !estudioImpactoAmbientalController.planSeleccionado.planManejo.ingresoDetalle}">
				<br />
				<p:outputLabel value="Ingrese justificación" styleClass="bold"
					for="justificacion" />
				<p:inputTextarea
					placeholder="Entre como mínimo 1 y como máximo 5000 caracteres."
					value="#{estudioImpactoAmbientalController.planSeleccionado.planManejo.justificacion}"
					id="justificacion" required="true"
					disabled="#{!estudioImpactoAmbientalController.habilitadoIngreso}"
					maxlength="5000" autoResize="false" rows="4">
					<p:ajax process="@this" />
				</p:inputTextarea>
			</h:panelGrid>
		</h:panelGrid>

		<h:inputHidden
			validator="#{estudioImpactoAmbientalController.validateDetalleSubPlan}" />
		
		<br />
		<p:separator />
		<div class="buttons">
			<p:commandButton styleClass="primary" value="Aceptar"
				actionListener="#{estudioImpactoAmbientalController.aceptarDetalleSubPlan()}"
				process="dlgAdjuntarPlanManejo"
				oncomplete="if(!args.validationFailed) PF('dlgAdjuntarPlanManejo').hide()"
				update=":form:acdPlan"
				rendered="#{estudioImpactoAmbientalController.habilitadoIngreso}" />
			<p:commandButton value="Cancelar" styleClass="secondary"
				oncomplete="PF('dlgAdjuntarPlanManejo').hide()" process="@this"
				update=":formDialogAdjunto:dlgAdjuntarPlanManejo">
				<p:resetInput target="@form" />
			</p:commandButton>
		</div>
	</p:dialog>

	<p:dialog id="dlgAnexoSubPlan" widgetVar="dlgAnexoSubPlan"
		header="Adjuntar anexo programa" modal="true" resizable="false">
		<p:panelGrid columns="1" columnClasses="label, value">
			<h:outputText value="Seleccione el archivo PDF (.pdf)" />
			<p:fileUpload uploadLabel="Subir" auto="true" cancelLabel="Cancelar"
				label="Seleccionar" mode="advanced" dragDropSupport="false"
				process="dlgAnexoSubPlan" multiple="false"
				allowTypes="/(\.|\/)(pdf)$/" sizeLimit="20971520"
				invalidFileMessage="Tipo de archivo no válido"
				invalidSizeMessage="Debe adjuntar un archivo no mayor de 20 Mb."
				immediate="true" oncomplete="PF('dlgAnexoSubPlan').hide()"
				update=":form:acdPlan"
				fileUploadListener="#{estudioImpactoAmbientalController.uploadAnexoSubPlan}" />
		</p:panelGrid>

		<br />

		<p:separator />
		<div class="buttons">
			<p:commandButton type="button" value="Cerrar"
				onclick="PF('dlgAnexoSubPlan').hide()" />
		</div>
	</p:dialog>

	<p:dialog id="dlgVerObservacionSubPlan"
		widgetVar="dlgVerObservacionSubPlan" header="Detalle observación"
		modal="true" resizable="false">
		<p:panelGrid columns="1" columnClasses="label, value">
			<h:panelGrid styleClass="w100" columns="1">

				<p:outputLabel value="Campo observado" styleClass="bold" />
				<p:inputText
					value="#{estudioImpactoAmbientalController.campoObservacionPma}"
					disabled="true" />
				<br />
				<p:outputLabel value="Observación" styleClass="bold" />
				<control:imputConTextoEnriquecido
					valor="#{estudioImpactoAmbientalController.detalleObservacionPma}"
					soloLectura="true" />
			</h:panelGrid>
		</p:panelGrid>

		<br />

		<p:separator />
		<div class="buttons">
			<p:commandButton type="button" value="Cerrar"
				onclick="PF('dlgVerObservacionSubPlan').hide()" />
		</div>
	</p:dialog>

</h:form>
			
</html>
