<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
      xmlns:controles="http://java.sun.com/jsf/composite/controles-prime"
      xmlns:pe="http://primefaces.org/ui/extensions">
<ui:composition template="/prevencion/licenciamiento-ambiental/eia/verEIA.xhtml">
    <ui:define name="content-eia">
        <h:form id="form">
            <p:panel header="Determinación del área de influencia">

                <p:panelGrid styleClass="w100" columns="1">
                    <f:facet name="header">
                        <h:outputText value="Documento de respaldo"/>
                    </f:facet>
                    <h:panelGrid styleClass="panel_data mw50" columns="2" columnClasses="header, null"
                                 rowClasses="null, alt">
                        <h:outputText id="etiqueta"
                                      value="#{areaInfluenciaBean.getDocumentoGeneral().getNombre()}"/>
                        <p:commandButton id="download" rendered="true"
                                         icon="ui-icon-search" ajax="false"
                                         styleClass="button-small primary" title="Ver" immediate="true">
                            <p:fileDownload value="#{areaInfluenciaBean.getStreamContent()}"/>
                        </p:commandButton>
                    </h:panelGrid>
                </p:panelGrid>

                <p:panelGrid columns="1" layout="grid" styleClass="w100" id="pnlGridInflDirecta">
                    <f:facet name="header">
                        <h:outputText value="Área de influencia directa"/>
                    </f:facet>
                    <h:outputLabel value="Componente físico" styleClass="bold"/>
                    <h:panelGrid styleClass="panel_data w100" columns="2" columnClasses="w25 header, null w75"
                                 rowClasses="null, alt">
                        <h:outputText value="Descripción" styleClass="bold"/>
                        <h:outputText id="dirFisDes"
                                      value="#{areaInfluenciaBean.areaInfluencia.directaFisicoDescripcion}"/>
                        <h:outputText value="Distancia" styleClass="bold"/>

                        <h:outputText id="dirFisDis"
                                      value="#{areaInfluenciaBean.areaInfluencia.directaFisicoDistancia} #{areaInfluenciaBean.areaInfluencia.directaFisicoDistanciaUnidad.simbolo}"
                                      styleClass="w50"/>
                    </h:panelGrid>


                    <h:outputLabel value="Componente biótico" styleClass="bold"/>
                    <h:panelGrid styleClass="panel_data w100" columns="2" columnClasses="w25 header, null w75"
                                 rowClasses="null, alt">

                        <h:outputText value="Descripción" styleClass="bold"/>
                        <h:outputText id="dirBioDes"
                                      value="#{areaInfluenciaBean.areaInfluencia.directaBioticoDescripcion}"
                                />


                        <h:outputText value="Distancia" styleClass="bold"/>


                        <h:outputText id="dirBioDis"
                                      value="#{areaInfluenciaBean.areaInfluencia.directaBioticoDistancia} #{areaInfluenciaBean.areaInfluencia.directaBioticoDistanciaUnidad.simbolo}"
                                />


                    </h:panelGrid>


                </p:panelGrid>


                <p:panelGrid columns="1" layout="grid" styleClass="w100" id="pnlGridInflIndirecta">
                    <f:facet name="header">
                        <h:outputText value="Área de influencia indirecta"/>
                    </f:facet>
                    <h:outputLabel value="Componente físico" styleClass="bold"/>
                    <h:panelGrid styleClass="panel_data w100" columns="2" columnClasses="w25 header, null w75"
                                 rowClasses="null, alt">
                        <h:outputText value="Descripción" styleClass="bold"/>
                        <h:outputText id="indFisDes"
                                      value="#{areaInfluenciaBean.areaInfluencia.indirectaFisicoDescripcion}"/>


                        <h:outputText value="Distancia" styleClass="bold"/>


                        <h:outputText id="indFisDis" value="#{areaInfluenciaBean.areaInfluencia.indirectaFisicoDistancia} #{areaInfluenciaBean.areaInfluencia.indirectaFisicoDistanciaUnidad.simbolo}"/>


                    </h:panelGrid>


                    <h:outputLabel value="Componente biótico" styleClass="bold"/>

                    <h:panelGrid styleClass="panel_data w100" columns="2" columnClasses="w25 header, w75 null"
                                 rowClasses="null, alt">
                        <h:outputText value="Descripción"  styleClass="bold"/>
                        <h:outputText id="indBioDes"
                                      value="#{areaInfluenciaBean.areaInfluencia.indirectaBioticoDescripcion}"
                                />


                        <h:outputText value="Distancia"  styleClass="bold"/>


                        <h:outputText id="indBioDis"
                                      value="#{areaInfluenciaBean.areaInfluencia.indirectaBioticoDistancia} #{areaInfluenciaBean.areaInfluencia.indirectaBioticoDistanciaUnidad.simbolo}"
                                />

                    </h:panelGrid>


                </p:panelGrid>

                <p:panelGrid columns="1" layout="grid" styleClass="w100" id="pnlGridInfraestructura">
                    <f:facet name="header">

                        <h:outputText value="Determinación de áreas de influencia del proyecto medio social"/>
                    </f:facet>
                    <p:dataTable id="tableInfraestructura" value="#{areaInfluenciaBean.infraestructurasAfectadas}"
                                 var="infraestructura" emptyMessage="#{labels['common.table.empty']}">
                        <p:columnGroup type="header">
                            <p:row>
                                <p:column rowspan="2"
                                          headerText="Infraestructura y/o actividades a las que afecta el proyecto"/>
                                <p:column colspan="2" headerText="Área de influencia directa"/>
                                <p:column colspan="2" headerText="Área de influencia indirecta"/>

                            </p:row>
                            <p:row>
                                <p:column headerText="Propietarios"/>
                                <p:column headerText="Comunidades, centros, poblados, etc."/>
                                <p:column headerText="Parroquias, territorios de nacionalidades indígenas, etc."/>
                                <p:column
                                        headerText="Otras jurisdicciones: Cantón, Provincia, etc. (Dependerá del alcance del proyecto)"/>
                            </p:row>
                        </p:columnGroup>
                        <p:column>
                            <h:outputText value="#{infraestructura.nombre}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{infraestructura.propietario}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{infraestructura.comunidad}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{infraestructura.lugar}"/>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{infraestructura.otraJurisdiccion}"/>
                        </p:column>


                    </p:dataTable>
                </p:panelGrid>


                <p:panelGrid columns="1" layout="grid" styleClass="w100" id="pnlGridDistancias">
                    <f:facet name="header">
                        <h:outputText
                                value="Distancia entre elementos del proyecto y los elementos sensibles del medio social"/>
                    </f:facet>
                    <p:dataTable id="tableDistancias" value="#{areaInfluenciaBean.infraestructurasAfectadas}"
                                 var="infraestructura" emptyMessage="#{labels['common.table.empty']}"
                                 tableStyle="table-layout: auto">

                        <p:columnGroup type="header">

                            <p:row>
                                <p:column colspan="2" headerText="Distancias"/>
                            </p:row>
                            <p:row>
                                <p:column headerText="Infraestructura"/>
                                <p:column headerText="Elementos sensibles"/>

                            </p:row>

                        </p:columnGroup>

                        <p:column>
                            <h:outputText value="#{infraestructura.nombre}"/>
                        </p:column>
                        <p:column>
                            <p:dataTable var="distancia" value="#{infraestructura.distanciaElementoSensibles}"  emptyMessage="#{labels['common.table.empty']}">

                                <p:column headerText="Elemento">
                                    <h:outputText value="#{distancia.elementoSensible.nombre}"/>
                                </p:column>
                                <p:column headerText="Descripción">
                                    <h:outputText value="#{distancia.descripcion}"/>
                                </p:column>
                                <p:column headerText="Distancia (m)">
                                    <h:outputText value="#{distancia.distancia}"/>
                                </p:column>
                            </p:dataTable>
                        </p:column>


                    </p:dataTable>
                </p:panelGrid>
            </p:panel>





            <p:dialog header="Determinación de áreas de influencia del proyecto medio social"
                      id="adicionarInfraestructura" widgetVar="adicionarInfraestructura" modal="true" width="600"
                      resizable="false" draggable="false">
                <h:panelGroup id="infraestructuraContainer">
                    <h:panelGrid columns="2" styleClass="w100" columnClasses="w50, field_mrg w50">
                        <p:outputLabel value="Infraestructura y/o actividades del proyecto" for="infraestructura"/>
                        <p:outputLabel value="Propietarios" for="propietarios"/>
                        <p:inputTextarea id="infraestructura" styleClass="w50"
                                         value="#{areaInfluenciaBean.infraestructuraAfectada.nombre}" maxlength="500"
                                         required="true">
                            <f:validateLength maximum="500"/>
                        </p:inputTextarea>
                        <p:inputTextarea id="propietarios" styleClass="w50"
                                         value="#{areaInfluenciaBean.infraestructuraAfectada.propietario}"
                                         maxlength="500"
                                         required="true">
                            <f:validateLength maximum="500"/>
                        </p:inputTextarea>
                        <p:outputLabel value="Comunidades , centros, poblados, etc" for="comunidades"/>
                        <p:outputLabel value="Parroquia, Territorios de nacionalidades" for="lugar"/>
                        <p:inputTextarea id="comunidades" styleClass="w50"
                                         value="#{areaInfluenciaBean.infraestructuraAfectada.comunidad}"
                                         maxlength="500">
                            <f:validateLength maximum="500"/>
                        </p:inputTextarea>
                        <p:inputTextarea id="lugar" styleClass="w50"
                                         value="#{areaInfluenciaBean.infraestructuraAfectada.lugar}" maxlength="500"
                                         required="true">
                            <f:validateLength maximum="500"/>
                        </p:inputTextarea>

                        <p:outputLabel value="Otras jurisdicciones" for="otraJurisdiccion"/>
                        <br></br>
                        <p:inputTextarea id="otraJurisdiccion" styleClass="w50"
                                         value="#{areaInfluenciaBean.infraestructuraAfectada.otraJurisdiccion}"
                                         maxlength="500">
                            <f:validateLength maximum="500"/>
                        </p:inputTextarea>

                    </h:panelGrid>
                </h:panelGroup>

                <p:separator/>

                <div class="buttons">

                    <p:commandButton value="Cancelar" type="button" onclick="PF('adicionarInfraestructura').hide()"
                                     styleClass="secondary"/>
                </div>
            </p:dialog>


            <p:dialog header="Distancias entre los elementos del proyecto y los elementos sensibles del medio social"
                      id="adicionarDistancia" widgetVar="adicionarDistancia" modal="true" width="600"
                      resizable="false" draggable="false">

                <h:panelGroup id="distanciaContainer">
                    <h:panelGrid columns="2" styleClass="w100" columnClasses="w50, field_mrg w50">
                        <p:outputLabel value="Infraestructura y/o actividades del proyecto"/>
                        <h:outputText value="#{areaInfluenciaBean.infraestructuraAfectada.nombre}"/>
                    </h:panelGrid>

                    <p:panelGrid columns="1" layout="grid" styleClass="w100">
                        <f:facet name="header">

                            <h:outputText value="Elementos sensibles"/>
                        </f:facet>

                        <p:dataTable value="#{areaInfluenciaBean.infraestructuraAfectada.distanciaElementoSensibles}"
                                     var="distancia"  emptyMessage="#{labels['common.table.empty']}">
                            <p:column headerText="Elemento">
                                <h:outputText value="#{distancia.elementoSensible.nombre}"/>
                            </p:column>
                            <p:column headerText="Descripción">
                                <h:outputText value="#{distancia.descripcion}"/>
                            </p:column>
                            <p:column headerText="Distancia (m)">
                                <h:outputText value="#{distancia.distancia}"/>
                            </p:column>

                            <p:column styleClass="w40px alCenter">
                                <p:commandButton update=":form:adicionarElemento :form:pnlGridDistancias"
                                                 styleClass="button-small primary"
                                                 process="@this" icon="ui-icon-pencil"
                                                 actionListener="#{areaInfluenciaController.seleccionarDistancia(distancia)}"
                                                 oncomplete="PF('adicionarElemento').show()"/>
                                <p:commandButton update=":form:distanciaContainer :form:pnlGridDistancias"
                                                 styleClass="button-small primary" process="@this"
                                                 icon="ui-icon-circle-close"
                                                 actionListener="#{areaInfluenciaController.eliminarDistancia(distancia)}">
                                    <p:confirm header="Confirmación"
                                               message="¿Está seguro que desea eliminar esta distancia?"
                                               icon="ui-icon-alert"/>
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </p:panelGrid>
                </h:panelGroup>
                <p:separator/>

                <div class="buttons">
                    <p:commandButton
                            process="@none" value="Aceptar"
                            update=":form:tableInfraestructura :form:infraestructuraContainer :form:pnlGridDistancias"
                            onclick="PF('adicionarDistancia').hide()"/>

                </div>
            </p:dialog>


            <p:dialog header="Distancia"
                      id="adicionarElemento" widgetVar="adicionarElemento" modal="true" width="600"
                      resizable="false" draggable="false">
                <h:panelGroup id="elementoContainer">
                    <h:panelGrid columns="2" styleClass="w100" columnClasses="w50, field_mrg w50">
                        <p:outputLabel value="Elemento" for="elemento"/>
                        <p:outputLabel value="Descripción del elemento" for="descripcionElemento"/>
                        <p:selectOneMenu
                                id="elemento" required="true"
                                value="#{areaInfluenciaBean.distanciaElementoSensible.elementoSensible}"
                                converter="selectItemConverter">

                            <f:selectItem itemLabel="#{labels['common.item.choose']}" itemValue=""
                                          noSelectionOption="true"/>
                            <f:selectItems
                                    value="#{areaInfluenciaBean.catalogoElementosSensibles}" var="elemento"
                                    itemLabel="#{elemento.nombre}" itemValue="#{elemento}"/>
                        </p:selectOneMenu>

                        <p:inputTextarea id="descripcionElemento"
                                         value="#{areaInfluenciaBean.distanciaElementoSensible.descripcion}"
                                         maxlength="150"
                                         required="true">
                            <f:validateLength maximum="150"/>
                        </p:inputTextarea>
                        <p:outputLabel value="Distancia" for="distanciaElemento"/>
                        <br/>
                        <p:inputText value="#{areaInfluenciaBean.distanciaElementoSensible.distancia}"
                                     id="distanciaElemento">
                            <pe:keyFilter mask="num"/>
                        </p:inputText>
                    </h:panelGrid>


                </h:panelGroup>
                <p:separator/>

                <div class="buttons">
                    <p:commandButton actionListener="#{areaInfluenciaController.adicionarDistancia()}"
                                     process="@this :form:elementoContainer" value="Aceptar"
                                     update=":form:pnlGridDistancias :form:adicionarDistancia :form:adicionarElemento"
                                     oncomplete="showModalAddElemento(xhr, status, args)"/>
                    <p:commandButton value="Cancelar" type="button" onclick="PF('adicionarElemento').hide()"
                                     styleClass="secondary"/>
                </div>
            </p:dialog>
        </h:form>

        <script type="text/javascript">

            function showModalAddInfraestructura(xhr, status, args) {
                if (args.addInfraestructura)
                    PF('adicionarInfraestructura').hide();
                else
                    PF('adicionarInfraestructura').show();
            }


            function showModalAddElemento(xhr, status, args) {
                if (args.addElemento)
                    PF('adicionarElemento').hide();
                else
                    PF('adicionarElemento').show();
            }

        </script>


    </ui:define>
</ui:composition>
</html>