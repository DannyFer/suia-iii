<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/default-task.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:t="http://myfaces.apache.org/tomahawk"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:mae="http://java.sun.com/jsf/composite/mae-composite">
    <ui:define name="content">    
        <h:form id="form">
        
        <h:panelGrid styleClass="w100" id="panelDocumento" rendered="#{informeInspeccionForestalCAController.verPdf}">
			<h:outputText value="Elaborar Informe Inspección Forestal" styleClass="bold" />
			<p:separator />
			<object type="application/pdf" id="informe"
					data="#{informeInspeccionForestalCAController.urlPdf}?pfdrid_c=true"
					height="600" width="100%" />
		</h:panelGrid>
		
        <h:panelGrid styleClass="w100" rendered="#{!informeInspeccionForestalCAController.verPdf}">
        
            <h:panelGrid columns="2" layout="grid" styleClass="w75" cellpadding="4" cellspacing="4">                	
                	<p:outputLabel value="Código de Informe" for="codigo"/>
                	<p:outputLabel value="Fecha de Inspección" for="fechaInspeccion"/>
                    
                    <p:inputText id="codigo" required="true" value="#{informeInspeccionForestalCAController.informeForestal.codigo}"
                    maxlength="50" requiredMessage="El campo 'Código de Informe' es requerido." style="text-transform:uppercase;"/>
                    <p:calendar id="fechaInspeccion" value="#{informeInspeccionForestalCAController.informeForestal.fechaInspeccion}"
                    required="true" requiredMessage="El campo 'Fecha de Inspección' es requerido."
                    maxdate="#{informeInspeccionForestalCAController.currentDate}" readonlyInput="true" styleClass="w15" pattern="dd/MM/yyyy" navigator="true"/>
                    
                    <p:watermark value="MAE-DPA(correspondiente)-UNP-001(según corresponda)" for="codigo"/> 
            </h:panelGrid>            
        
        	<p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">
                	<mae:panelGridHeaderHelp conector="descripcionHelp" help="#{helps['ca.informe.forestal.descripcion']}" width="500px"/>
                	<p:outputLabel value="Descripción general del proyecto" for="descripcionProyecto"/>
                    <p:inputTextarea id="descripcionProyecto" required="true" value="#{informeInspeccionForestalCAController.informeForestal.descripcionProyecto}"
                    autoResize="false" rows="4" maxlength="2500" requiredMessage="El campo 'Descripción general del proyecto' es requerido."/> 
                </h:panelGrid>
            </p:panel>        	
        	
        	<p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">
                	<mae:panelGridHeaderHelp conector="objetivoHelp" help="#{helps['ca.informe.forestal.objetivo']}" width="500px"/>
                	<p:outputLabel value="Objetivo" for="codigo"/>
                    <p:inputTextarea id="objetivo" required="objetivo" value="#{informeInspeccionForestalCAController.informeForestal.objetivo}"
                    autoResize="false" rows="4" maxlength="2500" requiredMessage="El campo 'Objetivo' es requerido."/> 
                </h:panelGrid>
            </p:panel>
            
            <p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">
                	<mae:panelGridHeaderHelp conector="marcoLegalHelp" help="#{helps['ca.informe.forestal.marcolegal']}" width="500px" />
                	<p:outputLabel value="Marco Legal Aplicable" for="marcolegal"/>
                    <p:inputTextarea id="marcolegal" required="true" value="#{informeInspeccionForestalCAController.informeForestal.marcoLegal}"
                    autoResize="false" rows="4" maxlength="2500" requiredMessage="El campo 'Marco Legal Aplicable' es requerido."/> 
                </h:panelGrid>
            </p:panel>
                      
            <p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">
                	<mae:panelGridHeaderHelp conector="caracterizacionVegetallHelp" help="#{helps['ca.informe.forestal.caracterizacionvegetal']}" width="500px" />
                    <p:outputLabel value="Caracterización de cobertura vegetal del área de intervención" for="caracterizacion"/>
                    <p:inputTextarea id="caracterizacion" required="true" value="#{informeInspeccionForestalCAController.informeForestal.descripcionVegetacion}"
                    autoResize="false" rows="4" maxlength="2500" requiredMessage="El campo 'Caracterización de cobertura vegetal' es requerido."/> 
                </h:panelGrid>
            </p:panel>
            <p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4"> 
                	<mae:panelGridHeaderHelp conector="conclusioneslHelp" help="#{helps['ca.informe.forestal.conclusiones']}" width="500px" />   
                    <p:outputLabel value="Conclusiones" for="conclusiones"/>
                    <p:inputTextarea id="conclusiones" required="true" value="#{informeInspeccionForestalCAController.informeForestal.conclusiones}"
                    autoResize="false" rows="4" maxlength="2500" requiredMessage="El campo 'Conclusiones' es requerido."/> 
                </h:panelGrid>
            </p:panel>
            
            <p:panel>
            	<h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">  
                	<mae:panelGridHeaderHelp conector="recomendacionesHelp" help="#{helps['ca.informe.forestal.recomendaciones']}" width="500px"/>
                    <p:outputLabel value="Recomendaciones" for="recomendaciones"/>
                    <p:inputTextarea id="recomendaciones" required="true" value="#{informeInspeccionForestalCAController.informeForestal.recomendaciones}"
                    autoResize="false" rows="4" maxlength="2500" requiredMessage="El campo 'Recomendaciones' es requerido."/> 
                </h:panelGrid>
            </p:panel>
            <p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">  
                	<mae:panelGridHeaderHelp conector="coberturaHelp" help="#{helps['ca.informe.forestal.recomendaciones']}" width="500px"/>                    
                    <p:outputLabel value="¿El proyecto, obra o actividad, requiere remoción de cobertura vegetal nativa?" for="cobertura"/>
                    <p:selectOneRadio id="cobertura" required="true"  value="#{informeInspeccionForestalCAController.informeForestal.remocionCoberturaVegetal}"
                    requiredMessage="El campo 'Tiene remoción de cobertura vegetal nativa' es requerido.">                        	
                            <f:selectItem itemLabel="Si" itemValue="true"/>
                            <f:selectItem itemLabel="No" itemValue="false"/>                            
                    </p:selectOneRadio>  
                </h:panelGrid>
            </p:panel>
            <p:panel>                           
                <h:panelGrid columns="1" layout="grid" styleClass="w100" cellpadding="4" cellspacing="4">               
            		<p:outputLabel value="Incorporar como anexo fotografía de inspección y mapa de inspección (.pdf) *"/>
            		<h:panelGrid styleClass="w25" cellpalding="2" columns="2">
                                    <p:outputLabel id="nombreArchivoAdjunto"
                                                  value="#{informeInspeccionForestalCAController.informeForestal.adjunto.nombre}"/>
                                    <p:commandButton ajax="false" immediate="true"
                                                     rendered="#{!(informeInspeccionForestalCAController.informeForestal.adjunto.id==null)}"
                                                     onclick="PrimeFaces.monitorDownload(start, stop);"
                                                     styleClass="primary"
                                                     icon="ui-icon-arrowthick-1-s">
                                        <p:fileDownload
                                                value="#{informeInspeccionForestalCAController.descargar()}"/>
                                    </p:commandButton>
                                    <h:inputHidden id="nombreArchivoAdjuntoHidden"
                                                   value="#{informeInspeccionForestalCAController.nombreFileAdjunto}"/>
            		</h:panelGrid>
            		<p:fileUpload id="filePlano"
                                              fileUploadListener="#{informeInspeccionForestalCAController.fileUpload}"
                                              value="#{informeInspeccionForestalCAController.fileAdjunto}" sizeLimit="1048576"
                                              allowTypes="/(\.|\/)(pdf)$/" label="Seleccionar"
                                              uploadLabel="Subir" auto="true"
                                              update=":#{p:component('nombreArchivoAdjunto')},:#{p:component('nombreArchivoAdjuntoHidden')}"
                                              cancelLabel="Cancelar"
                                              invalidFileMessage="Tipo de archivo no válido, por favor seleccione un archivo de tipo PDF"
                                              invalidSizeMessage="Debe adjuntar un archivo no mayor de 1 Mb."
                                              styleClass="w50 toLeft" mode="advanced">
            		</p:fileUpload>
            	</h:panelGrid>
            </p:panel>
            
            <h:panelGroup id="containerCoordenadas">
				<p:panelGrid columns="1" layout="grid" styleClass="buttonAdjuntarCoordenadasContainer w100">
					<f:facet name="header">
						<p:commandButton value="Adjuntar" onclick="PF('adjuntarCoordenadas').show()" styleClass="buttonAdjuntarCoordenadas button-small-text toRight field_mrg" type="button" icon="ui-icon-document" rendered="#{!cargarCoordenadasBean.formato.equals('')}"/>
						<p:commandButton rendered="#{!empty cargarCoordenadasBean.plantillaCoordenadas}" value="Descargar plantilla" styleClass="button-small-text toRight field_mrg" icon="ui-icon-arrowthick-1-s" ajax="false" immediate="true">
							<p:fileDownload value="#{cargarCoordenadasBean.plantillaCoordenadas}" />
						</p:commandButton>
						<p:commandButton styleClass="button-small toRight field_mrg" ajax="false" immediate="true" icon="ui-icon-help">
							<p:fileDownload value="#{cargarCoordenadasBean.ayudaCoordenadas}" />
						</p:commandButton>
						<h:outputText value="Coordenadas Registradas en Campo*" />
					</f:facet>
					<t:aliasBeansScope>
						<t:aliasBean alias="#{libreEleccionAlias}" value="false" />
						<ui:include src="/comun/cargarCoordenadas.xhtml" />
					</t:aliasBeansScope>
				</p:panelGrid>
				<p:panelGrid columns="1" layout="grid" styleClass="buttonSeleccionarUbicacionContainer w100" rendered="false">
					<t:aliasBeansScope>
						<t:aliasBean alias="#{adicionarUbicacionesAliasBean}" value="#{adicionarUbicacionesBean}"/>				
						<ui:include src="/comun/adicionarUbicaciones.xhtml"/>
					</t:aliasBeansScope>					
				</p:panelGrid>
				<script type="text/javascript">
					arrow_indicator_start_onover(".arrow-indicator3", 4, '.buttonAdjuntarCoordenadasContainer', false);					
				</script>				
				<p:dataTable id="tbl_coordenadas2" rowIndexVar="index" value="#{informeInspeccionForestalCAController.listaCoordenadas}" var="item" emptyMessage=""
				rendered="#{cargarCoordenadasBean.coordinatesWrappers.size()==0}">
					<p:subTable value="#{item.coordenadas}" var="coordenada">
						<p:columnGroup type="header">
							<p:row>
								<p:column headerText="Grupo de coordenadas #{index + 1} (#{item.tipoForma})" styleClass="alCenter w100 table-column-header" colspan="6" />
							</p:row>
							<p:row>
								<p:column headerText="Shape" styleClass="alCenter table-column-header" />
								<p:column headerText="X" styleClass="alCenter table-column-header" />
								<p:column headerText="Y" styleClass="alCenter table-column-header" />
								<p:column headerText="Tipo" styleClass="alCenter table-column-header" />
								<p:column headerText="Descripci&oacute;n" styleClass="alCenter table-column-header" />
								<p:column headerText="Zona" styleClass="alCenter table-column-header" />
							</p:row>
						</p:columnGroup>
						<p:column headerText="Shape" styleClass="alCenter w15">
							<h:outputText value="#{coordenada.orden}" />
								</p:column>
							<p:column headerText="X" styleClass="alCenter w15">
								<h:outputText value="#{coordenada.x.intValue()}" />
							</p:column>
							<p:column headerText="Y" styleClass="alCenter w15">
								<h:outputText value="#{coordenada.y.intValue()}" />
							</p:column>
							<p:column headerText="Tipo" styleClass="alCenter w15">
								<h:outputText value="#{item.tipoForma}" />
							</p:column>
							<p:column headerText="Descripci&oacute;n" styleClass="alCenter">
								<h:outputText value="#{coordenada.descripcion}" />
							</p:column>
							<p:column headerText="Zona" styleClass="alCenter">
								<h:outputText value="#{coordenada.zona}" />
							</p:column>
				</p:subTable>
			</p:dataTable>
			</h:panelGroup>
			
			
			
            
                        
            
        </h:panelGrid>
            
                 <t:div styleClass="buttons main">                            
                            <p:commandButton value="Guardar" rendered="#{!informeInspeccionForestalCAController.verPdf}"
                                             action="#{informeInspeccionForestalCAController.guardar()}"
                                             icon="ui-icon-disk" update=":#{p:component('form')}"/>
                            <p:commandButton value="Editar" rendered="#{informeInspeccionForestalCAController.verPdf}"
                                             action="#{informeInspeccionForestalCAController.editarFormulario()}"
                                             icon="ui-icon-pencil" update=":#{p:component('form')}"/>
                            
                           <!--               <p:commandButton value="Firmar" rendered="#{informeInspeccionForestalCAController.verPdf}"  -->
<!--             								 onclick="PF('signDialogFirmar').show();" -->
<!--             								 icon="ui-icon-key"/> -->
							<p:commandButton value="Firmar" immediate="true"
											 rendered="#{informeInspeccionForestalCAController.verPdf}"
											 actionListener="#{informeInspeccionForestalCAController.generar()}"
											 onclick="PF('signDialog').show();" icon="ui-icon-key" />
                  </t:div>
                  
<!--                 <p:dialog header="Firmar Documento" id="signDialogFirmar" widgetVar="signDialogFirmar" closeOnEscape="false" modal="true" resizable="false" width="auto" height="auto" position="center top">                 -->
<!--                 <p:panel> -->
<!--                     <h:panelGrid columns="2" cellpadding="10" style="text-align:right !important"> -->
<!--                      	<p:outputLabel value="1. Descargue el documento" styleClass="bold"/> -->
<!--                         <p:commandButton value="Descargar" ajax="false" icon="ui-icon-arrowthick-1-s" styleClass="primary" immediate="true"> -->
<!--                             <p:fileDownload value="#{informeInspeccionForestalCAController.descargarDocumento()}"/> -->
<!--                         </p:commandButton>                         -->
                                            
<!--                         <p:outputLabel value="2. Adjunte el documento firmado " styleClass="bold"/> -->
<!--                         <p:fileUpload -->
<!--                                 fileUploadListener="#{informeInspeccionForestalCAController.uploadFileFirmado}" -->
<!--                                 multiple="false" sizeLimit="5242880" allowTypes="/(\.|\/)(pdf)$/i" -->
<!--                                 label="Seleccionar" uploadLabel="Subir" -->
<!--                                 invalidFileMessage="Tipo de archivo no válido" -->
<!--                                 invalidSizeMessage="Tamaño de archivo no válido" -->
<!--                                 cancelLabel="Cancelar" mode="advanced" dragDropSupport="false" -->
<!--                                 auto="true" update="signDialogFirmar">                             -->
<!--                         </p:fileUpload> -->
<!--                     </h:panelGrid> -->
<!--                 </p:panel>                 -->
<!--             </p:dialog> -->
         </h:form>  
         
         <h:form id="formDialogs">

			<p:dialog header="Firma Electrónica" id="signDialog"
				widgetVar="signDialog" closeOnEscape="false" modal="true"
				resizable="false" width="600px" height="auto">
				<p:panel>
					<h:panelGrid styleClass="w100" columns="1">
						<h:outputLabel value="Firmar informe de inspeccion"
							styleClass="bold" />
					</h:panelGrid>
					<br />
					<br />
					<h:panelGrid styleClass="w100" columns="3"
						columnClasses="w25, w25 toCenter, toCenter">
						<p:outputLabel value="¿Cuenta con token?" styleClass="bold"
							rendered="#{!informeInspeccionForestalCAController.ambienteProduccion}" />
						<p:selectOneRadio id="verificaToken"
							value="#{informeInspeccionForestalCAController.token}"
							rendered="#{!informeInspeccionForestalCAController.ambienteProduccion}">
							<f:selectItem itemLabel="Sí" itemValue="true" />
							<f:selectItem itemLabel="No" itemValue="false" />
							<p:ajax event="change"
								update=":formDialogs:pnlFirmaManual :formDialogs:pnlFirmaToken"
								listener="#{informeInspeccionForestalCAController.guardarToken}" />
						</p:selectOneRadio>

						<h:outputText value="" styleClass="encabezado"
							rendered="#{informeInspeccionForestalCAController.ambienteProduccion}" />
						<h:outputText value="" styleClass="encabezado"
							rendered="#{informeInspeccionForestalCAController.ambienteProduccion}" />

						<h:panelGroup id="pnlFirmaToken">
							<p:commandButton value="Firmar documento" type="button"
								styleClass="primary" icon="ui-icon-key"
								rendered="#{informeInspeccionForestalCAController.token}"
								actionListener="#{informeInspeccionForestalCAController.generar()}"
								onclick="window.location.href='#{informeInspeccionForestalCAController.firmarOficio()}'" />
						</h:panelGroup>
					</h:panelGrid>

					<br />

					<h:panelGroup id="pnlFirmaManual">
						<h:panelGrid columns="2" cellpadding="10" styleClass="w100"
							style="text-align:right !important" columnClasses="w66, toCenter"
							rendered="#{!informeInspeccionForestalCAController.token}">
							<p:outputLabel value="1. Descargar el Informe" styleClass="bold" />
							<p:commandButton value="Descargar" ajax="false"
								icon="ui-icon-arrowthick-1-s" styleClass="primary"
								immediate="true">
								<p:fileDownload
									value="#{informeInspeccionForestalCAController.descargarDocumento()}" />
							</p:commandButton>
							<p:outputLabel for="uploadRequired"
								value="2. Adjuntar el Informe firmado"
								styleClass="bold" />
							<p:fileUpload id="Idfirmada"
								fileUploadListener="#{informeInspeccionForestalCAController.uploadFileFirmado}"
								multiple="false" sizeLimit="5242880"
								allowTypes="/(\.|\/)(pdf)$/i" label="Seleccionar"
								uploadLabel="Subir"
								invalidFileMessage="Tipo de archivo no válido"
								invalidSizeMessage="Tamaño de archivo no válido"
								cancelLabel="Cancelar" mode="advanced" dragDropSupport="false"
								auto="true" update="lblNombreDocFirmado"
								rendered="#{!informeInspeccionForestalCAController.token}">
								<f:attribute name="clave" value=":form" />
							</p:fileUpload>
							<p:outputLabel value="" />
							<h:outputText id="lblNombreDocFirmado"
								value="#{informeInspeccionForestalCAController.nombreDocumentoFirmado}" />
						</h:panelGrid>

						<h:inputHidden id="uploadRequired"
							required="#{!informeInspeccionForestalCAController.token and !informeInspeccionForestalCAController.informacionSubida}" />
					</h:panelGroup>
					<br />
				</p:panel>

				<p:separator />
				<div class="buttons main">
					<p:commandButton value="Cerrar" styleClass="primary"
						onclick="PF('signDialog').hide()" icon="ui-icon-close" />
					<p:commandButton value="Enviar" styleClass="secondary"
						action="#{informeInspeccionForestalCAController.enviar()}"
						icon="ui-icon-check">
						<p:confirm message="#{msg['message.confirmacion.envio.tarea']}"
							header="#{msg['header.confirmacion.envio.tarea']}" />
					</p:commandButton>
				</div>
			</p:dialog>

			<p:separator />

		</h:form>         
 
    </ui:define>
</ui:composition>